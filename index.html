<!DOCTYPE html>
<html lang="ja">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ (æ™‚åˆ»è¨ˆç®—ç‰ˆ)</title>
   <style>
       body {
           font-family: 'Helvetica Neue', Arial, sans-serif;
           text-align: center;
           padding-top: 50px;
           transition: background-color 0.5s ease;
           margin: 0;
           height: 100vh;
           overflow: hidden;
       }
       body.work { background-color: #ffeded; }
       body.short-break { background-color: #e8f5e9; }
       body.long-break { background-color: #e3f2fd; }
       body.idle { background-color: #f5f5f5; }

       .container {
           background: white;
           width: 85%;
           max-width: 340px;
           margin: 0 auto;
           padding: 30px;
           border-radius: 24px;
           box-shadow: 0 10px 30px rgba(0,0,0,0.1);
       }

       #status { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
       .work #status { color: #d32f2f; }
       .short-break #status { color: #388e3c; }
       .long-break #status { color: #1976d2; }

       #timer { font-size: 72px; font-family: 'Courier New', monospace; margin: 10px 0; color: #333; }
       #sets { font-size: 16px; color: #888; margin-bottom: 25px; }
       
       button {
           padding: 15px;
           font-size: 18px;
           cursor: pointer;
           border: none;
           border-radius: 12px;
           background: #333;
           color: white;
           font-weight: bold;
           width: 100%;
       }
       button:disabled { background: #bbb; opacity: 0.7; }
       
       .test-mode-area { margin-top: 25px; padding-top: 15px; border-top: 1px dashed #ccc; font-size: 13px; color: #999; }
   </style>
</head>
<body class="idle">

<div class="container">
   <div id="status">æº–å‚™å®Œäº†</div>
   <div id="timer">25:00</div>
   <div id="sets">ç¾åœ¨ã®ã‚»ãƒƒãƒˆ: 1</div>
   <button id="startBtn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

   <div class="test-mode-area">
       <label>
           <input type="checkbox" id="testMode"> <b>ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ (1ç§’=1åˆ†)</b>
       </label>
   </div>
</div>

<script>
   let timerInterval;
   let endTime; // çµ‚äº†äºˆå®šæ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
   let timeLeft; // æ®‹ã‚Šç§’æ•°
   let isRunning = false;
   let currentStep = 0;
   let setCounter = 1;

   const statusDisplay = document.getElementById('status');
   const timerDisplay = document.getElementById('timer');
   const setsDisplay = document.getElementById('sets');
   const startBtn = document.getElementById('startBtn');
   const testModeCheck = document.getElementById('testMode');

   const steps = [
       { name: "ä½œæ¥­ä¸­ ğŸ”¥", time: 25, color: "work" },
       { name: "å°ä¼‘æ†© â˜•", time: 5, color: "short-break" },
       { name: "ä½œæ¥­ä¸­ ğŸ”¥", time: 25, color: "work" },
       { name: "å°ä¼‘æ†© â˜•", time: 5, color: "short-break" },
       { name: "å¤§ä¼‘æ†© ğŸ›Œ", time: 20, color: "long-break" }
   ];

   function playSound() {
       const ctx = new (window.AudioContext || window.webkitAudioContext)();
       const osc = ctx.createOscillator();
       const gain = ctx.createGain();
       osc.connect(gain); gain.connect(ctx.destination);
       osc.frequency.setValueAtTime(880, ctx.currentTime);
       gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1);
       osc.start(); osc.stop(ctx.currentTime + 1);
   }

   function updateDisplay() {
       let mins = Math.floor(Math.max(0, timeLeft) / 60);
       let secs = Math.max(0, timeLeft) % 60;
       const timeStr = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
       timerDisplay.textContent = timeStr;
       document.title = timeStr + " - ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­";
   }

   function startTimer(durationInSeconds) {
       isRunning = true;
       startBtn.disabled = true;
       
       // â˜…é‡è¦ï¼šç¾åœ¨ã®æ™‚åˆ»ã«ã€Œè¨­å®šç§’æ•°ã€ã‚’è¶³ã—ã¦ã€Œçµ‚äº†æ™‚åˆ»ã€ã‚’å›ºå®šã™ã‚‹
       endTime = Date.now() + (durationInSeconds * 1000);
       
       const current = steps[currentStep];
       statusDisplay.textContent = current.name;
       document.body.className = current.color;

       timerInterval = setInterval(() => {
           // ç¾åœ¨æ™‚åˆ»ã¨çµ‚äº†äºˆå®šæ™‚åˆ»ã®å·®åˆ†ã‚’è¨ˆç®—
           timeLeft = Math.round((endTime - Date.now()) / 1000);
           
           updateDisplay();

           if (timeLeft <= 0) {
               clearInterval(timerInterval);
               isRunning = false;
               playSound();
               nextStep();
           }
       }, 200); // ç²¾åº¦ã‚’ä¸Šã’ã‚‹ãŸã‚200msã”ã¨ã«ãƒã‚§ãƒƒã‚¯
   }

   function nextStep() {
       currentStep++;
       if (currentStep >= steps.length) {
           currentStep = 0;
           setCounter++;
           setsDisplay.textContent = `ç¾åœ¨ã®ã‚»ãƒƒãƒˆ: ${setCounter}`;
           startBtn.disabled = false;
           statusDisplay.textContent = "å…¨ã‚»ãƒƒãƒˆå®Œäº†ï¼";
           document.body.className = "idle";
           return;
       }

       let nextDuration = steps[currentStep].time;
       if (!testModeCheck.checked) nextDuration *= 60;
       
       // æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è‡ªå‹•é–‹å§‹
       setTimeout(() => startTimer(nextDuration), 1000);
   }

   startBtn.onclick = () => {
       if (isRunning) return;
       let initialDuration = steps[currentStep].time;
       if (!testModeCheck.checked) initialDuration *= 60;
       startTimer(initialDuration);
   };

   // åˆæœŸè¡¨ç¤º
   timeLeft = steps[0].time * 60;
   updateDisplay();
</script>
</body>
</html>